{"version":3,"file":"SidebarView.js","names":["SidebarView","props","_this","setBuckets","indexes","indexIdentifier","buckets","activeBuckets","_underscore","each","idx","identifier","bucket","bucketItems","activeBucketItems","item","state","filterList","has","code","get","indexOf","key","push","_extends","isActive","select","selectItem","length","map","filters","splice","set","delete","_knockout","observableArray","result","activeIndex","_jquery","document","click","e","target","closest","toggleClass","subscribe","index"],"sources":["../../ts/src/in-page/SidebarView.ts"],"sourcesContent":["import { Bucket, BucketItem, IndexResult, Result } from \"../types\"\nimport _ from \"underscore\"\nimport ko from \"knockout\"\nimport $ from \"jquery\"\n\ninterface Props {\n    result: KnockoutObservable<Result>\n    activeIndex: KnockoutObservable<string>\n    filterList: KnockoutObservable<Map<string, string>>\n}\n\ninterface SelectableBucketItem extends BucketItem {\n    select: () => void\n    isActive: boolean\n}\n\ninterface SelectableBucket {\n    code: string\n    label: string\n    buckets: SelectableBucketItem[]\n    activeBuckets: SelectableBucketItem[]\n}\n\nexport class SidebarView {\n    props: Props\n\n    buckets: KnockoutObservableArray<SelectableBucket>\n    activeBuckets: KnockoutObservableArray<SelectableBucket>\n\n    constructor(props: Props) {\n        this.props = props\n        this.buckets = ko.observableArray([])\n        this.activeBuckets = ko.observableArray([])\n\n        this.setBuckets(props.result().indexes, props.activeIndex())\n        $(document).click(\".mstInPage__bucket .filter-options-title\", e => {\n            $(e.target).closest(\".mstInPage__bucket\"). toggleClass(\"active\")\n        });\n\n        props.result.subscribe(result => this.setBuckets(result.indexes, props.activeIndex()))\n        props.activeIndex.subscribe(index => this.setBuckets(props.result().indexes, index))\n    }\n\n    setBuckets = (indexes: IndexResult[], indexIdentifier: string) => {\n        let buckets: SelectableBucket[] = []\n        let activeBuckets: SelectableBucket[] = []\n\n        _.each(indexes, idx => {\n            if (idx.identifier != indexIdentifier) {\n                return\n            }\n\n            _.each(idx.buckets, bucket => {\n                let bucketItems = [],\n                    activeBucketItems = []\n\n                _.each(bucket.buckets, item => {\n                    let state = this.props.filterList().has(bucket.code) && this.props.filterList().get(bucket.code).indexOf(item.key) >=0\n\n                    if (state) {\n                        activeBucketItems.push({\n                            ...item,\n                            isActive: state,\n                            select:   () => this.selectItem(bucket, item),\n                        })\n                    }\n\n                    bucketItems.push({\n                        ...item,\n                        isActive: state,\n                        select:   () => this.selectItem(bucket, item),\n                    })\n                })\n\n                if (bucketItems.length > 0) {\n                    buckets.push({\n                        ...bucket,\n                        buckets: bucketItems,\n                    })\n                }\n\n                if (activeBucketItems.length > 0) {\n                    activeBuckets.push({\n                        ...bucket,\n                        buckets: activeBucketItems,\n                    })\n                }\n            })\n        })\n\n        this.buckets(buckets)\n        this.activeBuckets(activeBuckets)\n    }\n\n    selectItem = (bucket: Bucket, item: BucketItem) => {\n        const map = this.props.filterList()\n\n        if (map.has(bucket.code)) {\n            let filters = map.get(bucket.code)\n            if (map.get(bucket.code).indexOf(item.key) >= 0) {\n                filters.splice([map.get(bucket.code).indexOf(item.key)], 1)\n                if (filters.length > 0) {\n                    map.set(bucket.code, filters)\n                } else {\n                    map.delete(bucket.code)\n                }\n            } else {\n                filters.push(item.key);\n                map.set(bucket.code, filters)\n            }\n        } else {\n            map.set(bucket.code, [item.key])\n        }\n\n        this.props.filterList(map)\n    }\n}\n"],"mappings":";;;MAuBaA,WAAW,GAMpB,SAAAA,YAAYC,KAAY,EAAE;IAAA;;IAAA,IAAAC,KAAA;IAAA,KAc1BC,UAAU,GAAG,UAACC,OAAsB,EAAEC,eAAuB,EAAK;MAC9D,IAAIC,OAA2B,GAAG,EAAE;MACpC,IAAIC,aAAiC,GAAG,EAAE;MAE1CC,WAAA,CAAEC,IAAI,CAACL,OAAO,EAAE,UAAAM,GAAG,EAAI;QACnB,IAAIA,GAAG,CAACC,UAAU,IAAIN,eAAe,EAAE;UACnC;QACJ;QAEAG,WAAA,CAAEC,IAAI,CAACC,GAAG,CAACJ,OAAO,EAAE,UAAAM,MAAM,EAAI;UAC1B,IAAIC,WAAW,GAAG,EAAE;YAChBC,iBAAiB,GAAG,EAAE;UAE1BN,WAAA,CAAEC,IAAI,CAACG,MAAM,CAACN,OAAO,EAAE,UAAAS,IAAI,EAAI;YAC3B,IAAIC,KAAK,GAAGd,KAAI,CAACD,KAAK,CAACgB,UAAU,CAAC,CAAC,CAACC,GAAG,CAACN,MAAM,CAACO,IAAI,CAAC,IAAIjB,KAAI,CAACD,KAAK,CAACgB,UAAU,CAAC,CAAC,CAACG,GAAG,CAACR,MAAM,CAACO,IAAI,CAAC,CAACE,OAAO,CAACN,IAAI,CAACO,GAAG,CAAC,IAAG,CAAC;YAEtH,IAAIN,KAAK,EAAE;cACPF,iBAAiB,CAACS,IAAI,CAAAC,QAAA,KACfT,IAAI;gBACPU,QAAQ,EAAET,KAAK;gBACfU,MAAM,EAAI,SAAAA,OAAA;kBAAA,OAAMxB,KAAI,CAACyB,UAAU,CAACf,MAAM,EAAEG,IAAI,CAAC;gBAAA;cAAA,EAChD,CAAC;YACN;YAEAF,WAAW,CAACU,IAAI,CAAAC,QAAA,KACTT,IAAI;cACPU,QAAQ,EAAET,KAAK;cACfU,MAAM,EAAI,SAAAA,OAAA;gBAAA,OAAMxB,KAAI,CAACyB,UAAU,CAACf,MAAM,EAAEG,IAAI,CAAC;cAAA;YAAA,EAChD,CAAC;UACN,CAAC,CAAC;UAEF,IAAIF,WAAW,CAACe,MAAM,GAAG,CAAC,EAAE;YACxBtB,OAAO,CAACiB,IAAI,CAAAC,QAAA,KACLZ,MAAM;cACTN,OAAO,EAAEO;YAAW,EACvB,CAAC;UACN;UAEA,IAAIC,iBAAiB,CAACc,MAAM,GAAG,CAAC,EAAE;YAC9BrB,aAAa,CAACgB,IAAI,CAAAC,QAAA,KACXZ,MAAM;cACTN,OAAO,EAAEQ;YAAiB,EAC7B,CAAC;UACN;QACJ,CAAC,CAAC;MACN,CAAC,CAAC;MAEFZ,KAAI,CAACI,OAAO,CAACA,OAAO,CAAC;MACrBJ,KAAI,CAACK,aAAa,CAACA,aAAa,CAAC;IACrC,CAAC;IAAA,KAEDoB,UAAU,GAAG,UAACf,MAAc,EAAEG,IAAgB,EAAK;MAC/C,IAAMc,GAAG,GAAG3B,KAAI,CAACD,KAAK,CAACgB,UAAU,CAAC,CAAC;MAEnC,IAAIY,GAAG,CAACX,GAAG,CAACN,MAAM,CAACO,IAAI,CAAC,EAAE;QACtB,IAAIW,OAAO,GAAGD,GAAG,CAACT,GAAG,CAACR,MAAM,CAACO,IAAI,CAAC;QAClC,IAAIU,GAAG,CAACT,GAAG,CAACR,MAAM,CAACO,IAAI,CAAC,CAACE,OAAO,CAACN,IAAI,CAACO,GAAG,CAAC,IAAI,CAAC,EAAE;UAC7CQ,OAAO,CAACC,MAAM,CAAC,CAACF,GAAG,CAACT,GAAG,CAACR,MAAM,CAACO,IAAI,CAAC,CAACE,OAAO,CAACN,IAAI,CAACO,GAAG,CAAC,CAAC,EAAE,CAAC,CAAC;UAC3D,IAAIQ,OAAO,CAACF,MAAM,GAAG,CAAC,EAAE;YACpBC,GAAG,CAACG,GAAG,CAACpB,MAAM,CAACO,IAAI,EAAEW,OAAO,CAAC;UACjC,CAAC,MAAM;YACHD,GAAG,CAACI,MAAM,CAACrB,MAAM,CAACO,IAAI,CAAC;UAC3B;QACJ,CAAC,MAAM;UACHW,OAAO,CAACP,IAAI,CAACR,IAAI,CAACO,GAAG,CAAC;UACtBO,GAAG,CAACG,GAAG,CAACpB,MAAM,CAACO,IAAI,EAAEW,OAAO,CAAC;QACjC;MACJ,CAAC,MAAM;QACHD,GAAG,CAACG,GAAG,CAACpB,MAAM,CAACO,IAAI,EAAE,CAACJ,IAAI,CAACO,GAAG,CAAC,CAAC;MACpC;MAEApB,KAAI,CAACD,KAAK,CAACgB,UAAU,CAACY,GAAG,CAAC;IAC9B,CAAC;IArFG,IAAI,CAAC5B,KAAK,GAAGA,KAAK;IAClB,IAAI,CAACK,OAAO,GAAG4B,SAAA,CAAGC,eAAe,CAAC,EAAE,CAAC;IACrC,IAAI,CAAC5B,aAAa,GAAG2B,SAAA,CAAGC,eAAe,CAAC,EAAE,CAAC;IAE3C,IAAI,CAAChC,UAAU,CAACF,KAAK,CAACmC,MAAM,CAAC,CAAC,CAAChC,OAAO,EAAEH,KAAK,CAACoC,WAAW,CAAC,CAAC,CAAC;IAC5D,IAAAC,OAAA,EAAEC,QAAQ,CAAC,CAACC,KAAK,CAAC,0CAA0C,EAAE,UAAAC,CAAC,EAAI;MAC/D,IAAAH,OAAA,EAAEG,CAAC,CAACC,MAAM,CAAC,CAACC,OAAO,CAAC,oBAAoB,CAAC,CAAEC,WAAW,CAAC,QAAQ,CAAC;IACpE,CAAC,CAAC;IAEF3C,KAAK,CAACmC,MAAM,CAACS,SAAS,CAAC,UAAAT,MAAM;MAAA,OAAIlC,KAAI,CAACC,UAAU,CAACiC,MAAM,CAAChC,OAAO,EAAEH,KAAK,CAACoC,WAAW,CAAC,CAAC,CAAC;IAAA,EAAC;IACtFpC,KAAK,CAACoC,WAAW,CAACQ,SAAS,CAAC,UAAAC,KAAK;MAAA,OAAI5C,KAAI,CAACC,UAAU,CAACF,KAAK,CAACmC,MAAM,CAAC,CAAC,CAAChC,OAAO,EAAE0C,KAAK,CAAC;IAAA,EAAC;EACxF,CAAC;EAAA;IAAA9C,WAAA,EAAAA;EAAA;AAAA"}